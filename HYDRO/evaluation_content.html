<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Évaluation FFESSM - Niveau 2</title>
  <style>
    body { font-family: Arial, sans-serif; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f0f0f0; }
    td.state-A { background-color: #b6f1c2; }
    td.state-ECA { background-color: #f9b5b5; }
    td.state-NT { background-color: #ddd; }
    td.label-left { text-align: left; font-weight: bold; color: #004466; background: #e0e0e0; }
    .pe40-header { background-color: #0F4166; color: white; font-weight: bold; text-align: left; padding-left: 10px; }
    .commune-header { background-color: #546B8D; color: white; font-weight: bold; text-align: left; padding-left: 10px; }
    .pa20-header { background-color: #B1B8CB; color: black; font-weight: bold; text-align: left; padding-left: 10px; }
    button { padding: 10px 20px; font-size: 16px; }
    #studentSelect { font-size: 16px; margin-bottom: 20px; }
    .ipd-note { width: 50px; }
    .readonly-score { background-color: #eee; padding: 4px 8px; border-radius: 4px; }
    .ipd-btn { margin-top: 10px; padding: 6px 12px; }
    .ipd-toggle { color: blue; text-decoration: underline; cursor: pointer; }
    .date-row input[type="date"] { width: 100%; box-sizing: border-box; font-size: 0.9em; text-align: center; }
    .absence-row select { width: 100%; font-size: 0.9em; }
    .remarks-row input { width: 100%; font-size: 0.9em; box-sizing: border-box; }
  </style>
</head>
<body>
<select id="studentSelect" onchange="genererEtCharger()">
  <option value="">-- Choisir un élève --</option>
  <option value="1">AINS Mathieu</option>
  <option value="2">BARTHELEMY Carole</option>
  <option value="3">BRAOUDE Dominique</option>
  <option value="4">DE VITI Gaétan</option>
  <option value="5">EHRHARD Virginie</option>
  <option value="6">EISNITZ Anne-Laure</option>
  <option value="7">LEPARMENTIER Damien</option>
  <option value="8">MORGAND Claire</option>
  <option value="9">OPIN Maxime</option>
  <option value="10">OURSEL Oxana</option>
  <option value="11">PINHEIRO Tony</option>
  <option value="12">RONDET Célian</option>
</select>
<h2>Évaluation Niveau 2 - FFESSM</h2>
<div id="contenuEvaluation"></div>
<div id="ipdModal" style="display:none; position:fixed; top:10%; left:20%; background:#fff; border:2px solid #ccc; padding:20px; z-index:9999; max-width:60%; box-shadow:0 0 15px rgba(0,0,0,0.5)" data-cell-ref="">
  <div id="ipdContent"></div>
  <button onclick="document.getElementById('ipdModal').style.display='none'">Fermer</button>
</div>
<script>
function genererEtCharger() {
  const container = document.getElementById("contenuEvaluation");
  let html = `<h3>Suivi des compétences</h3><table><tr><th>Compétences</th>`;
  for (let i = 1; i <= 7; i++) html += `<th>P${i}</th>`;
  html += `</tr>`;
  html += `<tr class='date-row'><td><strong>Date</strong></td>`;
  for (let i = 1; i <= 7; i++) html += `<td><input type='date' name='date_P${i}'></td>`;
  html += `</tr>`;
  html += `<tr class='absence-row'><td><strong>Statut</strong></td>`;
  for (let i = 1; i <= 7; i++) html += `<td><select name='absent_P${i}'><option value=''>OK</option><option>Absent</option><option>Annulée</option></select></td>`;
  html += `</tr>`;
  const competences = [
    { titre: "Compétences spécifiques — PE40", classes: "pe40-header", items: [
      "Ventilation & consommation", "Propulsion & équilibrage", "Communication avec GP", "Intervenir en relai sur un équipier en difficulté"] },
    { titre: "Compétences communes —", classes: "commune-header", items: [
      "S’équiper & mise à l’eau", "Immersion & propulsion", "Respect du milieu", "Vidage de masque", "Retour surface (cohésion de la palanquée & vitesse)", "Respect durée & profondeur annoncées par le DP", "Lestage adapté"] },
    { titre: "Compétences spécifiques — PA20", classes: "pa20-header", items: [
      "Planifier la plongée (sur le bateau)", "Vérif matériel équipiers (buddy check)", "Autonomie (Orientation)", "Autonomie (Conso & Déco)", "Parachute", "IPD1", "IPD2"] }
  ];
  competences.forEach(block => {
    html += `<tr><td colspan='8' class='${block.classes}'>${block.titre}</td></tr>`;
    block.items.forEach(item => {
      const isIPD = item.startsWith("IPD");
      html += `<tr><td class='label-left'>${item}</td>`;
      for (let i = 1; i <= 7; i++) {
        const cellRef = `${item}_P${i}`;
        if (isIPD) {
          html += `<td class='cell' data-cell-ref='${cellRef}' onclick='toggleIPDModal("${item}_P${i}", this)'>Non travaillé</td>`;
        } else {
          html += `<td class='cell' onclick='toggleState(this)'></td>`;
        }
      }
      html += `</tr>`;
    });
  });
  html += `<tr class='remarks-row'><td><strong>Remarques</strong></td>`;
  for (let i = 1; i <= 7; i++) html += `<td><input type='text' name='remarque_P${i}' placeholder='Remarque'></td>`;
  html += `</tr>`;
  html += `</table>`;
  container.innerHTML = html;
}
function toggleState(cell) {
  const states = ["", "A", "ECA", "NT"];
  let current = cell.getAttribute("data-state") || "";
  let nextIndex = (states.indexOf(current) + 1) % states.length;
  let nextState = states[nextIndex];
  cell.classList.remove("state-A", "state-ECA", "state-NT");
  cell.removeAttribute("data-state");
  cell.textContent = "";
  if (nextState) {
    cell.classList.add("state-" + nextState);
    cell.setAttribute("data-state", nextState);
    cell.textContent = nextState;
  }
}
</script>
</body>
</html>
